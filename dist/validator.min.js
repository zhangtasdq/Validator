var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();define("interface/EngineInterface",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("interface/ExecutorResult",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("interface/ExecutorInterface",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("impl/GroupExecutor",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.name=a,this.executor=b,this.childrens=[]}return a.prototype.execute=function(a,b){return this.executor(this.childrens,a,b)},a.prototype.addChild=function(a){this.childrens.push(a)},a}();b.default=c}),define("interface/OperatorInterface",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("impl/Operator",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.name=a,this.executor=b}return a.prototype.run=function(a,b){return this.executor(a,b)},a}();b.default=c}),define("interface/SingleRuleInterface",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),define("impl/SingleExecutor",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b,c){this.name=a,this.rule=b,this.operator=c}return a.prototype.getObjValueByPath=function(a,b){b=b.replace(/\[(\w+)\]/,".$1"),b=b.replace(/^\./,"");for(var c=b.split("."),d=a,e=0,f=c.length;e<f;++e){var g=c[e];if(!d.hasOwnProperty(g))break;d=d[g]}return f===c.length?d:null},a.prototype.getCurrentValue=function(a){return this.getObjValueByPath(a,this.rule.key)},a.prototype.getTargetValue=function(a){return this.rule.targetType&&"plainValue"!==this.rule.targetType?this.getObjValueByPath(a,this.rule.targetValue):this.rule.targetValue},a.prototype.execute=function(a,b){var c=this.getCurrentValue(a),d=this.getTargetValue(b);return this.operator.run(c,d)?{status:!0}:{status:!1,errorMsg:this.rule.errorMsg}},a}();b.default=c}),define("impl/ExecutorFactory",["require","exports","impl/GroupExecutor","impl/SingleExecutor"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(a,b,c){for(var d={status:!0},e=0,f=a.length;e<f&&(d=a[e].execute(b,c),d.status);++e);return d},f=function(a,b,c){for(var d=null,e=0,f=a.length;e<f&&(d=a[e].execute(b,c),!d.status);++e);return d},g=function(){function a(){this.groupExecutors={},this.addGroupExecutor("and",e),this.addGroupExecutor("or",f)}return a.prototype.groupExecutorBuilder=function(a,b){return function(c){function d(){return c.call(this,a,b)||this}return __extends(d,c),d}(c.default)},a.prototype.addGroupExecutor=function(a,b){this.groupExecutors[a]=this.groupExecutorBuilder(a,b)},a.prototype.buildSingleExecutor=function(a,b){return a=a,new d.default("singleExecutor",a,b)},a.prototype.buildGroupExecutor=function(a){var b=this.groupExecutors[a];if(!b)throw new Error("组 "+a+" 不存在!");return new b},a}();b.default=g}),define("impl/OperatorFactory",["require","exports","impl/Operator"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(a,b){return a===b},e=function(a,b){return a==b},f=function(a,b){return a!==b},g=function(a,b){return a<b},h=function(a,b){return a<=b},i=function(a,b){return a>b},j=function(a,b){return a>=b},k=function(a,b){return a.indexOf&&a.indexOf(b)!==-1},l=function(){function a(){this.operators={},this.addOperator("equal",d),this.addOperator("shadowEqual",e),this.addOperator("notEqual",f),this.addOperator("lessThan",g),this.addOperator("lessThanInclusive",h),this.addOperator("greaterThan",i),this.addOperator("greaterThanInclusive",j),this.addOperator("contains",k)}return a.prototype.addOperator=function(a,b){this.operators[a]=new c.default(a,b)},a.prototype.getOperator=function(a){var b=this.operators[a];if(!b)throw new Error("操作 "+a+" 不存在!");return b},a}();b.default=l}),define("impl/Parser",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.parse=function(a){var b=Object.keys(a);return 1===b.length?this.parseGroup(b[0],a[b[0]]):this.parseSingle(a)},a.prototype.parseGroup=function(a,b){for(var c=this.executorFactory.buildGroupExecutor(a),d=0,e=b.length;d<e;++d)c.addChild(this.parse(b[d]));return c},a.prototype.parseSingle=function(a){var b=this.operatorFactory.getOperator(a.operator);return this.executorFactory.buildSingleExecutor(a,b)},a.prototype.setExecutorFactory=function(a){this.executorFactory=a},a.prototype.setOperatorFactory=function(a){this.operatorFactory=a},a}();b.default=c}),define("impl/Engine",["require","exports","impl/ExecutorFactory","impl/Parser","impl/OperatorFactory"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a){void 0===a&&(a={}),this.executorFactory=new c.default,this.operatorFactory=new e.default,this.parser=new d.default,this.contextData=a,this.currentRule={}}return a.prototype.addRule=function(a,b){this.parser.setExecutorFactory(this.executorFactory),this.parser.setOperatorFactory(this.operatorFactory),this.currentRule[a]=this.parser.parse(b)},a.prototype.run=function(a,b,c,d){var e=this.currentRule[a];if(!e)throw new Error("规则 "+a+" 不存在!");var f=e.execute(b,this.contextData);f.status?c():d&&d(f)},a.prototype.addGroupExecutor=function(a,b){this.executorFactory.addGroupExecutor(a,b)},a.prototype.addOperator=function(a,b){this.operatorFactory.addOperator(a,b)},a}();b.default=f});
//# sourceMappingURL=validator.min.js.map